%% ============================================================
%% SECTION 5: COMPLETE SYSTEM ARCHITECTURE
%% ============================================================

flowchart TB
    subgraph PRESENTATION["PRESENTATION LAYER"]
        direction LR
        UI_DASH[Dashboard]
        UI_SUBS[Subscriptions]
        UI_TXN[Transactions]
        UI_REPORTS[Reports]
        UI_AI[AI Bottom Sheet]
        UI_OCR[OCR Scanner]
        UI_SETTINGS[Settings]
    end

    subgraph STATE["STATE MANAGEMENT - GetX"]
        direction LR
        CTRL_DASH[DashboardController]
        CTRL_SUBS[SubscriptionController]
        CTRL_TXN[TransactionController]
        CTRL_REPORTS[ReportsController]
        CTRL_AI[AIController]
        CTRL_OCR[OCRController]
        CTRL_SETTINGS[SettingsController]
    end

    subgraph REPOSITORY["REPOSITORY LAYER"]
        direction LR
        REPO_TXN[TransactionRepository]
        REPO_SUBS[SubscriptionRepository]
        REPO_CAT[CategoryRepository]
        REPO_USER[UserRepository]
    end

    subgraph SERVICES["SERVICES LAYER"]
        direction LR
        SVC_HIVE[HiveService]
        SVC_AI[GeminiService]
        SVC_OCR[OCRService]
        SVC_NOTIFY[NotificationService]
    end

    subgraph DATA["DATA LAYER - Hive Boxes"]
        direction LR
        BOX_TXN[(transactions)]
        BOX_SUBS[(subscriptions)]
        BOX_CAT[(categories)]
        BOX_USER[(userProfile)]
        BOX_REM[(reminders)]
        BOX_OCR[(ocrScans)]
        BOX_AI[(aiHistory)]
        BOX_ATTACH[(attachments)]
        BOX_SETTINGS[(settings)]
    end

    subgraph EXTERNAL["EXTERNAL SERVICES"]
        direction LR
        EXT_GEMINI[Gemini API]
        EXT_MLKIT[Google ML Kit]
        EXT_GOOGLE[Google Sign-In]
        EXT_NOTIFY[Local Notifications]
    end

    %% Connections
    PRESENTATION --> STATE
    STATE --> REPOSITORY
    REPOSITORY --> SERVICES
    SERVICES --> DATA
    SERVICES --> EXTERNAL

    style PRESENTATION fill:#E3F2FD,stroke:#1565C0
    style STATE fill:#F3E5F5,stroke:#7B1FA2
    style REPOSITORY fill:#E8F5E9,stroke:#2E7D32
    style SERVICES fill:#FFF8E1,stroke:#F9A825
    style DATA fill:#BBDEFB,stroke:#1976D2
    style EXTERNAL fill:#FFEBEE,stroke:#C62828
