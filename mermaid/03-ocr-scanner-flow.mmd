%% ============================================================
%% SECTION 3: OCR ENTRY DATA FLOW
%% ============================================================

flowchart TB
    subgraph OCR["OCR SCANNER FLOW"]
        direction TB

        O_START([User Opens Drawer]) --> O_MENU[Select OCR Scanner]
        O_MENU --> O_SOURCE{Image Source}

        O_SOURCE -->|Camera| O_CAMERA[Open Camera]
        O_SOURCE -->|Gallery| O_GALLERY[Open Gallery]

        O_CAMERA --> O_CAPTURE[Capture Image]
        O_GALLERY --> O_SELECT[Select Image]

        O_CAPTURE --> O_PREVIEW[Image Preview]
        O_SELECT --> O_PREVIEW

        O_PREVIEW --> O_CROP[Crop/Adjust - Optional]
        O_CROP --> O_PROCESS[Process with ML Kit]

        O_PROCESS --> O_EXTRACT[Extract Text]
        O_EXTRACT --> O_PARSE[Parse Data]

        O_PARSE --> O_DETECT_AMT[Detect Amount]
        O_PARSE --> O_DETECT_DATE[Detect Date]
        O_PARSE --> O_DETECT_VENDOR[Detect Vendor]

        O_DETECT_AMT --> O_RESULTS[Show Parsed Results]
        O_DETECT_DATE --> O_RESULTS
        O_DETECT_VENDOR --> O_RESULTS

        O_RESULTS --> O_REVIEW{User Review}

        O_REVIEW -->|Edit| O_EDIT_FORM[Edit Parsed Data]
        O_REVIEW -->|Confirm| O_CONFIRM[Confirm Transaction]
        O_REVIEW -->|Retry| O_PREVIEW
        O_REVIEW -->|Cancel| O_CANCEL([Discard])

        O_EDIT_FORM --> O_CONFIRM

        O_CONFIRM --> O_CAT[Select Category]
        O_CAT --> O_NOTES[Add Notes - Optional]
        O_NOTES --> O_SAVE[Save Transaction]

        %% Database Operations
        O_SAVE --> O_DB_SCAN[(Hive: ocrScans)]
        O_SAVE --> O_DB_TXN[(Hive: transactions)]
        O_SAVE --> O_DB_ATTACH[(Hive: attachments)]

        %% Store Image
        O_CONFIRM --> O_STORE_IMG[Store Scanned Image]
        O_STORE_IMG --> O_DB_ATTACH

        %% Update Dashboard
        O_DB_TXN --> O_REFRESH[Refresh Dashboard]
        O_REFRESH --> O_LEDGER[Update Ledger View]
        O_REFRESH --> O_ANALYTICS[Update Analytics]
    end

    style OCR fill:#FFF3E0,stroke:#E65100
    style O_DB_SCAN fill:#BBDEFB,stroke:#1976D2
    style O_DB_TXN fill:#BBDEFB,stroke:#1976D2
    style O_DB_ATTACH fill:#BBDEFB,stroke:#1976D2
    style O_PROCESS fill:#FCE4EC,stroke:#C2185B
